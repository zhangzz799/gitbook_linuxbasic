``# 用户权限相关命令

## 目标

* **用户** / **权限** / **组** 的基本概念
* **用户管理** 终端命令
* **访问权限** 终端命令

## 01. **用户管理**

### 1.1 多用户 和 超级用户

* Linux是**多用户操作系统**，即允许计算机上**可以建立多个用户并各自管理自己家目录**下的资源目录
* 系统用户中有一个**可以管理所有其他用户和计算机中所有资源**的用户，叫做**超级用户**
* 超级用户的账号是 `root`， 通常 **用于系统的维护和管理**
* 在大多数版本的 Linux 中，都不推荐 **直接使用 root 账号登录系统**

### 1.2 `sudo`

* `su` 是 `substitute user` 的缩写，表示 **使用另一个用户的身份**
* `sudo` 命令用来以其他身份来执行命令，预设的身份为 `root`
* 用户使用 `sudo` 时，必须先输入密码，之后有 **5 分钟的有效期限**，超过期限则必须重新输入密码

> 若其未经授权的用户企图使用 `sudo`，则会发出警告邮件给管理员

### 1.3 用户管理命令

| 序号 | 命令 | 作用 | 说明 |
| :--- | :--- | :--- | :--- |
| 01 | useradd -m 新建用户名 | 添加新用户 | -m 自动建立用户家目录 |
| 02 | passwd 用户名 | 设置用户密码 | 如果是普通用户，直接用 passwd 可以修改自己的账户密码 |
| 03 | userdel -r 用户名 | 删除用户 | -r 选项会自动删除用户家目录 |
| 04 | cat /etc/passwd │ grep 用户名 | 确认用户信息 | 新建用户后，用户信息会保存在 /etc/passwd 文件中 |

* **创建用户** / **删除用户** / **修改其他用户密码** 的终端命令都需要通过 `sudo` 执行
* 创建用户时，如果忘记添加 `-m` 选项指定新用户的家目录 —— 最简单的方法就是**删除用户，重新创建**
* `/etc` 目录是专门用来保存 **系统配置信息** 的目录，用户信息保存在 `/etc/passwd` 文件中

#### passwd 文件

`/etc/passwd` 文件存放的是用户的信息，由 6 个分号组成的 7 个信息，分别是

1. 用户名
2. 密码（x，表示加密的密码）
3. UID（用户标识）
4. GID（组标识）
5. 用户全名或本地帐号
6. 家目录
7. 登录使用的 `Shell`

> 真正执行命令行的并不是`终端`，而是`终端`启动时打开的一种工具`Shell`，`Shell`分很多种，但语法基本兼容，MacOS和Linux终端默认启动的`Shell`叫做`bash`

### 1.4 查看用户信息

| 序号 | 命令 | 作用 |
| --- | --- | --- |
| 01 | id \[用户名\] | 查看用户 UID 和 GID 信息 |
| 02 | who | 查看当前所有登录的用户列表 |
| 03 | whoami | 查看当前登录用户的账户名 |

### 1.5 切换用户

| 序号 | 命令 | 作用 | 说明 |
| --- | --- | --- | --- |
| 01 | su - 用户名 | 切换用户，并且切换目录 | - 可以切换到用户家目录，否则保持位置不变 |
| 02 | exit | 退出当前登录账户 |  |

* `su` 不接用户名，可以切换到 `root`，但是不推荐使用，因为不安全
* `exit` 示意图如下：

![003\_su和exit示意图](media/14934198815905/003_su和exit示意图.png)

## 02. **访问权限**

### 1.1 权限

* 创建文件/目录的**用户**作为文件**拥有者**，可以设置该文件/目录的**访问权限**
* 对 **文件／目录** 的权限包括：

| 序号 | 权限 | 英文 | 缩写 | 数字代号 |
| :---: | :---: | :---: | :---: | :---: |
| 01 | 读 | read | r | 4 |
| 02 | 写 | write | w | 2 |
| 03 | 执行 | excute | x | 1 |

### 1.2 `ls -l` 查看权限

* `ls -l` 可以查看文件夹下文件的详细信息，从左到右依次是：

  * **权限**，第 1 个字符如果是 `d` 表示目录
  * **硬链接数**，通俗地讲，就是有多少种方式，可以访问到当前目录／文件
  * **拥有者**，家目录下 文件／目录 的拥有者通常都是当前用户
  * **组**
  * **大小**
  * **时间**
  * **名称**

![002\_权限示意图](media/14934198815905/002_权限示意图.png)

### 1.4 `chmod` 简单使用

* `chmod` 可以修改 **用户** 对 **文件／目录** 的权限，是change mode的缩写
* 命令格式如下：

```bash
chmod +/-rwx 文件名|目录名
```
* 想要 **分别调整** 拥有者、组、其他用户对文件/目录的文件/目录的权限（了解）：

```bash
chmod u+/-rwx,g+/-rwx,o+/-rwx 文件名|目录名

chmod 764 文件名|目录名   # 表示设置文件权限：拥有者可读可写可执行，组可读可写，其他用户仅可读
```


### 1.5 可执行权限

* 目录默认都具有可执行权限，若目录不具有可执行权限，则该目录名 **不能参与命令行操作**
* 若文件具有可执行权限，则该文件可以 **以命令的形式被执行**


### 1.6 `usermod`

* `usermod` 命令可以修改用户所在组、附加权限、登录用户的shell等
* 新创建的用户不能使用`sudo`代用root权限，**可以使用`usermod`添加用户的sudo附加权限**



```bash
sudo usermod -G sudo 用户名 
```

### 1.7 which（重要）

* `which` 命令可以查看执行命令所在位置，例如：

```bash
which ls

# 输出
# /bin/ls

which useradd

# 输出
# /usr/sbin/useradd
```

##### `bin` 和 `sbin`

* 在 `Linux` 中，绝大多数可执行文件都是保存在 `/bin`、`/sbin`、`/usr/bin`、`/usr/sbin`
* `/bin`（`binary`）存放用户必备的软件 \(多数随系统安装\)
* `/sbin`（`system binary`）存放系统管理员 \(普通用户用不到的\) 必备的软件
* `/usr/bin`（`user commands for applications`）后期安装的给普通用户用的软件
* `/usr/sbin`（`super user commands for applications`）后期安装的给超级管理员用的软件

> 提示：
>
> * `cd` 这个终端命令是内置在系统内核中的，没有独立的文件，因此用 `which` 无法找到 `cd` 命令的位置



